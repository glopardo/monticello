--1 HEADER
SELECT
	CONVERT(VARCHAR(10), FCRBSNZDATE, 103) FCRBSNZDATEDDMMYYYY, CONVERT(VARCHAR(10), FCRBSNZDATE, 112) FCRBSNZDATEYYYYMMDD, CONVERT(VARCHAR(5),
	FCRBSNZDATE, 108) HORAMIN, FCRINVNUMBER, MICROSCHKNUM, SUBTOTAL1 SUBTOTALCONIVA, ROUND(SUBTOTAL1 / 1.19, 0) SUBTOTALSINIVA, EXTRAFIELD3
FROM
	MICROSDB.FCR_INVOICE_DATA
WHERE
	CONVERT(VARCHAR(10), FCRBSNZDATE, 112) = '20180801' AND EXTRAFIELD5 = 'PDV'
ORDER BY FCRBSNZDATE DESC

--2 DETAIL
SELECT
	CHECKID, CHECKNUMBER, WORKSTATIONID, CHECKOPEN,
	TABLEOPEN, CHECKCLOSE, SPLITFROMCHECKNUM, SUBTOTAL, TAX, OTHER, PAYMENT, DUE
FROM
	MICROSDB.CHECKS
WHERE
	CONVERT(VARCHAR(10), CHECKPOSTINGTIME, 112) = '" + READER["FCRBSNZDATEYYYYMMDD"]'
	AND CONVERT(VARCHAR(5), CHECKPOSTINGTIME, 108) = '" + READER["HORAMIN"] + "'
	AND CHECKNUMBER = 'CHKNUM'

--3 ITEMS
SELECT
	CHECK_DETAIL.CHECKDETAILID, FAMILY_GROUP.OBJECTNUMBER FAMGRP,CHECK_DETAIL.CHECKID, CHECK_DETAIL.DETAILINDEX,
	CHECK_DETAIL.DETAILTYPE, ROUND(CHECK_DETAIL.TOTAL / 1.19, 0) TOTALSINIVA, CHECK_DETAIL.TOTAL TOTAL, CHECK_DETAIL.SALESCOUNT,
	STRING_TABLE.STRINGTEXT, MENU_ITEM_DEFINITION.MENUITEMDEFID MENUITEMDEFID, MENU_ITEM_MASTER.OBJECTNUMBER OBJECTNUMBER
FROM
	MICROSDB.CHECK_DETAIL CHECK_DETAIL
	INNER JOIN MICROSDB.MENU_ITEM_DETAIL MENU_ITEM_DETAIL ON CHECK_DETAIL.CHECKDETAILID = MENU_ITEM_DETAIL.CHECKDETAILID
	INNER JOIN MICROSDB.MENU_ITEM_DEFINITION MENU_ITEM_DEFINITION ON MENU_ITEM_DEFINITION.MENUITEMDEFID = MENU_ITEM_DETAIL.MENUITEMDEFID
	INNER JOIN MICROSDB.STRING_TABLE STRING_TABLE ON STRING_TABLE.STRINGNUMBERID = MENU_ITEM_DEFINITION.NAME1ID
	INNER JOIN MICROSDB.MENU_ITEM_MASTER MENU_ITEM_MASTER ON MENU_ITEM_MASTER.MENUITEMMASTERID = MENU_ITEM_DEFINITION.MENUITEMMASTERID
	INNER JOIN MICROSDB.FAMILY_GROUP FAMILY_GROUP ON FAMILY_GROUP.FAMGRPID = MENU_ITEM_MASTER.FAMGRPID
WHERE
	CHECKID = 12444175 AND TOTAL <> 0
ORDER BY CHECK_DETAIL.DETAILINDEX

--PAGOS
SELECT
	CHECK_DETAIL.CHECKDETAILID, CHECK_DETAIL.CHECKID, CHECK_DETAIL.DETAILINDEX,
	CHECK_DETAIL.DETAILTYPE, CHECK_DETAIL.TOTAL, CHECK_DETAIL.SALESCOUNT, TENDER_MEDIA_DETAIL.TENDMEDID
FROM
	CHECK_DETAIL
	INNER JOIN TENDER_MEDIA_DETAIL ON CHECK_DETAIL.CHECKDETAILID = TENDER_MEDIA_DETAIL.CHECKDETAILID
WHERE
	CHECKID = " + subReaderChecks["CHECKID"] + " AND TOTAL > 0
ORDER BY CHECK_DETAIL.DETAILINDEX

-- QUERY PARA BUSCAR FAMILY GROUPS
SELECT
	STRING_TABLE.STRINGTEXT, FG.FAMGRPID, FG.OBJECTNUMBER
FROM
	MICROSDB.FAMILY_GROUP FG
	LEFT OUTER JOIN MICROSDB.STRING_TABLE STRING_TABLE ON STRING_TABLE.STRINGNUMBERID = FG.NAMEID
ORDER BY FG.OBJECTNUMBER